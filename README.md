# BousSOle

Сервис автоматизации стройотрядов

## Деплой

Состоит из трех стейджей:
  
1. `build` - сборка приложения. Запускается автоматически на МР и мастере при пуше коммитов. Артефакты хранятся 1 день

2. `prepare` - подготовка к публикации. Включает в себя 3 этапа:

    а) `push_image` - загрузка собранного образа приложения в реестр образов ([реестр тут](https://medveden91.ddns.net/boussole/backend/container_registry)). Требует обязательного завершения `build`

    б) `renew_ssl_certificate` - обновление SSL сертификатов на сервере. Необязательный этап. Нужно запускать раз в 3 месяца (сертификат действителен 90 дней). **Останавливает все работающие сервисы на хосте перед обновлением сертификатов!**

    в) `start_postgres` - запуск базы данных на сервере. Если уже запущена, то сначала будет остановлена, потом запущена снова

3. `deploy` - запуск последнего доступного образа boussole:latest на сервере. Состоит из двух этапов:

    а) `start_test_boussole` - запуск в режиме Development. Доступен только в МР

    б) `start_prod_boussole` - запуск в режиме Production. Доступен только из мастера

**Development** от **Production** отличаются только наличием/отсутствием swagger'а